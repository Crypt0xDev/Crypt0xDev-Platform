---
/**
 * HackTheBox Writeup Template
 * Dynamic route for rendering individual HackTheBox writeups
 * @platform HackTheBox
 */

import { getCollection } from 'astro:content';
import WriteupLayout from '../../../../layouts/WriteupLayout.astro';
import TOC from '../../../../components/common/TOC.astro';
import RelatedWriteups from '../../../../components/writeup/RelatedWriteups.astro';
import { formatDate } from '../../../../i18n/utils';
import { useTranslations } from '../../../../i18n/core';

// ============================================================================
// Static Path Generation
// ============================================================================

export async function getStaticPaths() {
  const writeupEntries = await getCollection('writeups', ({ data }) => {
    return data.platform === 'htb';
  });
  
  return writeupEntries.map(entry => {
    // El slug viene como: "es/hackthebox/codify"
    // Necesitamos solo: "codify" (sin idioma ni plataforma)
    const slugParts = entry.slug.split('/');
    const actualSlug = slugParts.slice(2).join('/'); // Elimina idioma Y plataforma
    const lang = entry.data.language || 'es';
    
    return {
      params: { lang: lang, slug: actualSlug },
      props: { entry },
    };
  });
}

// ============================================================================
// Data Preparation
// ============================================================================

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
const t = useTranslations(entry.data.language as 'es' | 'en');

// ============================================================================
// Related Writeups Logic
// ============================================================================

const allWriteups = await getCollection('writeups', ({ data }) => {
  return data.language === entry.data.language && data.platform === 'htb';
});

const currentTags = entry.data.tags || [];
const currentCategory = entry.data.category;
const currentDifficulty = entry.data.difficulty;

// Calculate similarity score and get related writeups
const related = allWriteups
  .filter(w => w.slug !== entry.slug)
  .map(w => ({
    writeup: w,
    score: 
      (w.data.category === currentCategory ? 3 : 0) +
      (w.data.difficulty === currentDifficulty ? 2 : 0) +
      (w.data.tags?.filter(t => currentTags.includes(t)).length || 0)
  }))
  .filter(({ score }) => score > 0)
  .sort((a, b) => {
    if (b.score !== a.score) return b.score - a.score;
    return new Date(b.writeup.data.pubDate).getTime() - new Date(a.writeup.data.pubDate).getTime();
  })
  .slice(0, 3)
  .map(({ writeup }) => writeup);

// Fill with recent writeups if needed
if (related.length < 3) {
  const remaining = allWriteups
    .filter(w => w.slug !== entry.slug && !related.includes(w))
    .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
    .slice(0, 3 - related.length);
  related.push(...remaining);
}

// ============================================================================
// Constants & Configurations
// ============================================================================

const difficultyColors = {
  easy: '#10b981',
  medium: '#f59e0b',
  hard: '#ef4444',
  insane: '#8b5cf6'
} as const;

const categoryNames: Record<string, string> = {
  machines: entry.data.language === 'es' ? 'M√°quinas' : 'Machines',
  challenges: entry.data.language === 'es' ? 'Desaf√≠os' : 'Challenges',
  fortresses: entry.data.language === 'es' ? 'Fortalezas' : 'Fortresses',
  endgames: entry.data.language === 'es' ? 'Endgames' : 'Endgames'
} as const;

const categoryIcons = {
  machines: 'üíª',
  challenges: 'üèÜ',
  fortresses: 'üè∞',
  endgames: 'üéÆ'
} as const;

const osIcons = {
  linux: 'üêß',
  windows: 'ü™ü',
  other: 'üíª'
} as const;
---

<WriteupLayout
  title={entry.data.title}
  description={entry.data.description}
  lang={entry.data.language}
  image={entry.data.heroImage}
  pubDate={entry.data.pubDate}
  updatedDate={entry.data.updatedDate}
  platform={entry.data.platform}
  difficulty={entry.data.difficulty}
  os={entry.data.os}
  tags={entry.data.tags}
  retired={entry.data.retired}
>
  <article class="htb-writeup">
    <!-- ================================================================ -->
    <!-- Header Section -->
    <!-- ================================================================ -->
    <header class="writeup-header">
      <!-- Hero Image -->
      {entry.data.heroImage && (
        <div class="hero-container">
          <div class="hero-image-wrapper">
            <img 
              src={entry.data.heroImage} 
              alt={entry.data.title}
              class="hero-image"
              loading="eager"
            />
          </div>
        </div>
      )}
      
      <div class="header-content">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href={`/${entry.data.language}/writeup`}>{t('writeups.title')}</a>
          <span class="separator" aria-hidden="true">/</span>
          <a href={`/${entry.data.language}/writeup/hackthebox`}>HackTheBox</a>
          {entry.data.category && (
            <>
              <span class="separator" aria-hidden="true">/</span>
              <a href={`/${entry.data.language}/writeup/hackthebox/${entry.data.category}`}>
                {categoryNames[entry.data.category] || entry.data.category}
              </a>
            </>
          )}
        </nav>

        <!-- Title -->
        <h1 class="writeup-title">{entry.data.title}</h1>
        
        <!-- Badges -->
        <div class="badge-container" role="list">
          <span class="badge badge-platform" role="listitem">
            <span class="badge-icon" aria-hidden="true">üì¶</span>
            <span class="badge-text">HackTheBox</span>
          </span>
          
          {entry.data.category && (
            <span class="badge badge-category" role="listitem">
              <span class="badge-icon" aria-hidden="true">
                {categoryIcons[entry.data.category as keyof typeof categoryIcons]}
              </span>
              <span class="badge-text">
                {categoryNames[entry.data.category] || entry.data.category}
              </span>
            </span>
          )}
          
          <span 
            class="badge badge-difficulty" 
            role="listitem"
            style={`background-color: ${difficultyColors[entry.data.difficulty]}15; color: ${difficultyColors[entry.data.difficulty]}; border: 2px solid ${difficultyColors[entry.data.difficulty]}50;`}
          >
            <span class="difficulty-indicator" aria-hidden="true"></span>
            <span class="badge-text">
              {entry.data.difficulty.charAt(0).toUpperCase() + entry.data.difficulty.slice(1)}
            </span>
          </span>
          
          {entry.data.os && (
            <span class="badge badge-os" role="listitem">
              <span class="badge-icon" aria-hidden="true">
                {osIcons[entry.data.os as keyof typeof osIcons] || osIcons.other}
              </span>
              <span class="badge-text">
                {entry.data.os.charAt(0).toUpperCase() + entry.data.os.slice(1)}
              </span>
            </span>
          )}
          
          {entry.data.retired && (
            <span class="badge badge-retired" role="listitem">
              <span class="retired-icon" aria-hidden="true">‚ö°</span>
              <span class="badge-text">{t('writeups.retired')}</span>
            </span>
          )}
        </div>

        <!-- Metadata -->
        <div class="metadata">
          <time datetime={entry.data.pubDate.toISOString()}>
            <span aria-hidden="true">üìÖ</span>
            {formatDate(entry.data.pubDate, entry.data.language)}
          </time>
          {entry.data.updatedDate && (
            <span class="metadata-item">
              <span aria-hidden="true">üîÑ</span>
              {t('blog.updated_on')}: {formatDate(entry.data.updatedDate, entry.data.language)}
            </span>
          )}
          {entry.data.estimatedTime && (
            <span class="metadata-item">
              <span aria-hidden="true">‚è±Ô∏è</span>
              {entry.data.estimatedTime}
            </span>
          )}
          {entry.data.points && (
            <span class="metadata-item">
              <span aria-hidden="true">üèÜ</span>
              {entry.data.points} pts
            </span>
          )}
        </div>

        <!-- Additional Technical Information -->
        {(entry.data.attackVectors || entry.data.certifications || entry.data.vulnerabilities || entry.data.techniques) && (
          <section class="technical-info" aria-label="Technical Information">
            {entry.data.attackVectors && entry.data.attackVectors.length > 0 && (
              <div class="info-block">
                <h2 class="info-title">
                  <span aria-hidden="true">üéØ</span>
                  {entry.data.language === 'es' ? 'Vectores de Ataque' : 'Attack Vectors'}
                </h2>
                <div class="info-badges">
                  {entry.data.attackVectors.map((vector) => (
                    <span class="info-badge info-badge-vector">
                      {vector.replace('-', ' ')}
                    </span>
                  ))}
                </div>
              </div>
            )}
            
            {entry.data.techniques && entry.data.techniques.length > 0 && (
              <div class="info-block">
                <h2 class="info-title">
                  <span aria-hidden="true">üî¨</span>
                  {entry.data.language === 'es' ? 'T√©cnicas MITRE ATT&CK' : 'MITRE ATT&CK Techniques'}
                </h2>
                <div class="info-badges">
                  {entry.data.techniques.map((technique) => (
                    <span class="info-badge info-badge-technique">{technique}</span>
                  ))}
                </div>
              </div>
            )}
            
            {entry.data.certifications && entry.data.certifications.length > 0 && (
              <div class="info-block">
                <h2 class="info-title">
                  <span aria-hidden="true">üéì</span>
                  {entry.data.language === 'es' ? 'Certificaciones Relacionadas' : 'Related Certifications'}
                </h2>
                <div class="info-badges">
                  {entry.data.certifications.map((cert) => (
                    <span class="info-badge info-badge-cert">{cert}</span>
                  ))}
                </div>
              </div>
            )}

            {entry.data.vulnerabilities && entry.data.vulnerabilities.length > 0 && (
              <div class="info-block">
                <h2 class="info-title">
                  <span aria-hidden="true">üîì</span>
                  {entry.data.language === 'es' ? 'Vulnerabilidades (CVEs)' : 'Vulnerabilities (CVEs)'}
                </h2>
                <div class="info-badges">
                  {entry.data.vulnerabilities.map((vuln) => (
                    <span class="info-badge info-badge-vuln">{vuln}</span>
                  ))}
                </div>
              </div>
            )}
          </section>
        )}

        <!-- Tags Section -->
        {entry.data.tags && entry.data.tags.length > 0 && (
          <section class="tags-section" aria-label="Tags">
            <div class="tags-header">
              <span class="tags-icon" aria-hidden="true">üè∑Ô∏è</span>
              <h2 class="tags-title">{entry.data.language === 'es' ? 'Etiquetas' : 'Tags'}</h2>
            </div>
            <div class="tags-list">
              {entry.data.tags.map((tag) => (
                <a 
                  href={`/${entry.data.language}/tag/${tag.toLowerCase().replace(/\s+/g, '-')}`}
                  class="tag-link"
                >
                  <span class="tag-hash" aria-hidden="true">#</span>
                  <span class="tag-text">{tag}</span>
                  <span class="tag-arrow" aria-hidden="true">‚Üí</span>
                </a>
              ))}
            </div>
          </section>
        )}
      </div>
    </header>

    <!-- ================================================================ -->
    <!-- Main Content & TOC -->
    <!-- ================================================================ -->
    <div class="content-container">
      <div class="content-wrapper">
        <div class="main-content prose">
          <Content />
        </div>
      </div>
    </div>

    <!-- TOC Fixed (fuera del flujo) -->
    {headings.length > 0 && (
      <aside class="toc-wrapper">
        <TOC headings={headings} title={t('writeups.table_of_contents')} inline={false} platform="htb" />
      </aside>
    )}

    <!-- ================================================================ -->
    <!-- Related Writeups Section -->
    <!-- ================================================================ -->
    {related.length > 0 && (
      <section class="related-section" aria-label="Related Writeups">
        <RelatedWriteups 
          writeups={related as any} 
          title={t('writeups.related_writeups')}
          lang={entry.data.language}
        />
      </section>
    )}
  </article>
</WriteupLayout>

<style>
  /* ========================================================================
     BASE LAYOUT
     ======================================================================== */

  .htb-writeup {
    --htb-primary: #9fef00;
    --htb-primary-dark: #7dd800;
    --htb-primary-light: #b4ff1a;
    
    max-width: 1600px;
    margin: 0 auto;
    padding: 2rem 1rem 4rem;
    position: relative;
  }

  /* Background Effects - Muy sutiles para no distraer */
  .htb-writeup::before {
    content: '';
    position: fixed;
    inset: 0;
    height: 100vh;
    background: 
      radial-gradient(circle at 20% 30%, color-mix(in srgb, #9fef00 2%, transparent 98%) 0%, transparent 40%),
      radial-gradient(circle at 80% 70%, color-mix(in srgb, #9fef00 1%, transparent 99%) 0%, transparent 40%);
    z-index: -1;
    pointer-events: none;
    opacity: 0.5;
  }

  .htb-writeup::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      linear-gradient(color-mix(in srgb, #9fef00 1%, transparent 99%) 1px, transparent 1px),
      linear-gradient(90deg, color-mix(in srgb, #9fef00 1%, transparent 99%) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 0.3;
    z-index: -1;
    pointer-events: none;
  }

  /* ========================================================================
     HEADER SECTION
     ======================================================================== */

  .writeup-header {
    max-width: 1200px;
    margin: 0 auto 3rem;
    position: relative;
    z-index: 5;
    padding: 0 1rem;
  }

  @media (min-width: 640px) {
    .writeup-header {
      padding: 0 2rem;
    }
  }

  /* Hero Image */
  .hero-container {
    max-width: 100%;
    margin: 0 auto 1.5rem;
    perspective: 1000px;
  }

  @media (min-width: 640px) {
    .hero-container {
      max-width: 600px;
      margin-bottom: 2rem;
    }
  }

  .hero-image-wrapper {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    background: var(--card-bg);
    border: 1px solid rgba(159, 239, 0, 0.15);
    transition: all 0.3s ease;
  }

  .hero-container:hover .hero-image-wrapper {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(159, 239, 0, 0.15);
    border-color: rgba(159, 239, 0, 0.25);
  }

  .hero-image {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
    position: relative;
    z-index: 0;
  }

  /* Header Content */
  .header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  @media (min-width: 640px) {
    .header-content {
      padding: 0 1.5rem;
    }
  }

  /* ========================================================================
     BREADCRUMB NAVIGATION
     ======================================================================== */

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 96%, #9fef00 4%) 0%, 
      color-mix(in srgb, var(--bg-color) 98%, #9fef00 2%) 100%
    );
    overflow-x: auto;
    white-space: nowrap;
    border-radius: 12px;
    border: 2px solid color-mix(in srgb, var(--border-color) 70%, #9fef00 30%);
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  .breadcrumb::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: linear-gradient(180deg, 
      #9fef00 0%, 
      color-mix(in srgb, #9fef00 50%, transparent 50%) 100%
    );
    border-radius: 3px 0 0 3px;
  }

  @media (min-width: 640px) {
    .breadcrumb {
      font-size: 0.9375rem;
      margin-bottom: 2rem;
      padding: 1.125rem 1.75rem;
    }
  }

  .breadcrumb a {
    color: #9fef00;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 700;
    position: relative;
  }

  .breadcrumb a::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 0;
    height: 2px;
    background: #9fef00;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(159, 239, 0, 0.3);
  }

  .breadcrumb a:hover {
    color: #b4ff1a;
    transform: translateY(-1px);
  }

  .breadcrumb a:hover::after {
    width: 100%;
  }

  .separator {
    color: color-mix(in srgb, #9fef00 50%, var(--text-muted) 50%);
    opacity: 0.6;
    font-weight: 600;
  }

  /* ========================================================================
     TITLE
     ======================================================================== */

  .writeup-title {
    font-size: clamp(1.75rem, 5vw, 2.5rem);
    font-weight: 900;
    line-height: 1.2;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--htb-primary) 0%, var(--htb-primary-light) 50%, var(--htb-primary) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.02em;
    position: relative;
  }

  @media (min-width: 640px) {
    .writeup-title {
      margin-bottom: 1.25rem;
    }
  }

  @media (min-width: 768px) {
    .writeup-title {
      margin-bottom: 1.5rem;
    }
  }

  /* ========================================================================
     BADGES
     ======================================================================== */

  .badge-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  @media (min-width: 640px) {
    .badge-container {
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1.125rem;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    border: 2px solid transparent;
  }

  .badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
    transition: left 0.5s ease;
  }

  .badge:hover::before {
    left: 100%;
  }

  .badge-icon {
    font-size: 1.1em;
    display: flex;
    align-items: center;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .badge-text {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.85em;
  }

  @media (min-width: 640px) {
    .badge {
      padding: 0.625rem 1.25rem;
      font-size: 0.9375rem;
      gap: 0.625rem;
    }
  }

  /* Badge Variants */
  .badge-platform {
    background: linear-gradient(135deg, var(--htb-primary) 0%, var(--htb-primary-dark) 100%);
    color: #0a0f0a;
    box-shadow: 0 2px 8px rgba(159, 239, 0, 0.2);
    font-weight: 800;
    border: 2px solid rgba(255, 255, 255, 0.2);
  }

  .badge-platform:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(159, 239, 0, 0.3);
  }

  .badge-category {
    background: rgba(159, 239, 0, 0.08);
    color: var(--htb-primary);
    border: 2px solid rgba(159, 239, 0, 0.25);
    font-weight: 700;
  }

  .badge-category:hover {
    background: rgba(159, 239, 0, 0.12);
    border-color: rgba(159, 239, 0, 0.35);
    transform: translateY(-2px);
  }

  .badge-difficulty {
    font-weight: 700;
    backdrop-filter: blur(8px);
    position: relative;
  }

  .difficulty-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
    box-shadow: 0 0 8px currentColor;
  }

  .badge-difficulty:hover {
    transform: translateY(-2px);
  }

  .badge-os {
    background: var(--card-bg);
    color: var(--text-color);
    border: 2px solid rgba(159, 239, 0, 0.2);
    font-weight: 600;
  }

  .badge-os:hover {
    background: rgba(159, 239, 0, 0.06);
    border-color: rgba(159, 239, 0, 0.3);
    transform: translateY(-2px);
  }

  .badge-retired {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.12), rgba(245, 158, 11, 0.06));
    color: #f59e0b;
    border: 2px solid rgba(245, 158, 11, 0.3);
    font-weight: 700;
  }

  .retired-icon {
    animation: flash 2s ease-in-out infinite;
  }

  @keyframes flash {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .badge-retired:hover {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.18), rgba(245, 158, 11, 0.1));
    border-color: rgba(245, 158, 11, 0.4);
    transform: translateY(-2px);
  }

  /* ========================================================================
     METADATA
     ======================================================================== */

  .metadata {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    color: var(--text-muted);
    font-size: 0.9375rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
  }

  .metadata-item {
    color: var(--text-muted);
  }

  /* ========================================================================
     TECHNICAL INFORMATION
     ======================================================================== */

  .technical-info {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 98%, #9fef00 2%) 0%, 
      color-mix(in srgb, var(--bg-color) 99%, #9fef00 1%) 100%
    );
    border: 2px solid color-mix(in srgb, var(--border-color) 70%, #9fef00 30%);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 4px 20px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
  }

  .technical-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(180deg, 
      #9fef00 0%, 
      color-mix(in srgb, #9fef00 60%, transparent 40%) 100%
    );
    border-radius: 4px 0 0 4px;
  }

  .technical-info::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(
      circle,
      color-mix(in srgb, #9fef00 8%, transparent 92%) 0%,
      transparent 70%
    );
    pointer-events: none;
  }

  .info-block {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid color-mix(in srgb, var(--border-color) 80%, #9fef00 20%);
    position: relative;
    z-index: 1;
  }

  .info-block:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
  }

  .info-title {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    margin-bottom: 1.25rem;
    color: #9fef00;
    font-size: 1rem;
    font-weight: 800;
    letter-spacing: 0.02em;
    text-transform: uppercase;
  }

  .info-title span {
    font-size: 1.25rem;
    filter: drop-shadow(0 2px 4px rgba(159, 239, 0, 0.2));
  }

  .info-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .info-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: default;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .info-badge::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 10px;
    padding: 2px;
    background: linear-gradient(135deg, currentColor, transparent);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .info-badge:hover {
    transform: translateY(-3px) scale(1.05);
  }

  .info-badge:hover::before {
    opacity: 0.5;
  }

  .info-badge-vector {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 92%, #9fef00 8%) 0%, 
      color-mix(in srgb, var(--bg-color) 95%, #9fef00 5%) 100%
    );
    color: #9fef00;
    border: 2px solid color-mix(in srgb, var(--border-color) 60%, #9fef00 40%);
  }

  .info-badge-vector:hover {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 88%, #9fef00 12%) 0%, 
      color-mix(in srgb, var(--bg-color) 92%, #9fef00 8%) 100%
    );
    border-color: #9fef00;
    box-shadow: 0 4px 16px color-mix(in srgb, #9fef00 20%, transparent 80%);
  }

  .info-badge-technique {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 92%, #3b82f6 8%) 0%, 
      color-mix(in srgb, var(--bg-color) 95%, #3b82f6 5%) 100%
    );
    color: #3b82f6;
    border: 2px solid color-mix(in srgb, var(--border-color) 60%, #3b82f6 40%);
  }

  .info-badge-technique:hover {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 88%, #3b82f6 12%) 0%, 
      color-mix(in srgb, var(--bg-color) 92%, #3b82f6 8%) 100%
    );
    border-color: #3b82f6;
    box-shadow: 0 4px 16px color-mix(in srgb, #3b82f6 20%, transparent 80%);
  }

  .info-badge-cert {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 92%, #10b981 8%) 0%, 
      color-mix(in srgb, var(--bg-color) 95%, #10b981 5%) 100%
    );
    color: #10b981;
    border: 2px solid color-mix(in srgb, var(--border-color) 60%, #10b981 40%);
  }

  .info-badge-cert:hover {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 88%, #10b981 12%) 0%, 
      color-mix(in srgb, var(--bg-color) 92%, #10b981 8%) 100%
    );
    border-color: #10b981;
    box-shadow: 0 4px 16px color-mix(in srgb, #10b981 20%, transparent 80%);
  }

  .info-badge-vuln {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 92%, #ef4444 8%) 0%, 
      color-mix(in srgb, var(--bg-color) 95%, #ef4444 5%) 100%
    );
    color: #ef4444;
    border: 2px solid color-mix(in srgb, var(--border-color) 60%, #ef4444 40%);
  }

  .info-badge-vuln:hover {
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 88%, #ef4444 12%) 0%, 
      color-mix(in srgb, var(--bg-color) 92%, #ef4444 8%) 100%
    );
    border-color: #ef4444;
    box-shadow: 0 4px 16px color-mix(in srgb, #ef4444 20%, transparent 80%);
  }

  /* ========================================================================
     TAGS SECTION
     ======================================================================== */

  .tags-section {
    margin-top: 2.5rem;
    padding: 2rem;
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 98%, #9fef00 2%) 0%, 
      color-mix(in srgb, var(--bg-color) 99%, #9fef00 1%) 100%
    );
    border: 2px solid color-mix(in srgb, var(--border-color) 75%, #9fef00 25%);
    border-radius: 16px;
    position: relative;
    overflow: hidden;
  }

  .tags-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(180deg, 
      #9fef00 0%, 
      color-mix(in srgb, #9fef00 50%, transparent 50%) 100%
    );
  }

  .tags-header {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    margin-bottom: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid color-mix(in srgb, var(--border-color) 80%, #9fef00 20%);
  }

  .tags-icon {
    font-size: 1.5rem;
    filter: drop-shadow(0 2px 4px rgba(159, 239, 0, 0.15));
  }

  .tags-title {
    font-size: 1rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #9fef00;
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.875rem;
  }

  .tag-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: linear-gradient(135deg, 
      color-mix(in srgb, var(--bg-color) 94%, #9fef00 6%) 0%, 
      color-mix(in srgb, var(--bg-color) 97%, #9fef00 3%) 100%
    );
    color: #9fef00;
    border: 2px solid color-mix(in srgb, var(--border-color) 65%, #9fef00 35%);
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .tag-hash {
    font-size: 1.1em;
    font-weight: 800;
    opacity: 0.8;
  }

  .tag-text {
    font-weight: 700;
    letter-spacing: 0.02em;
  }

  .tag-arrow {
    opacity: 0;
    transform: translateX(-8px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 900;
    font-size: 1.1em;
  }

  .tag-link:hover {
    background: linear-gradient(135deg, 
      #9fef00 0%, 
      #b4ff1a 100%
    );
    border-color: #9fef00;
    color: #0a0f0a;
    transform: translateY(-2px) scale(1.02);
    box-shadow: 
      0 6px 20px color-mix(in srgb, #9fef00 25%, transparent 75%),
      0 0 30px color-mix(in srgb, #9fef00 15%, transparent 85%);
  }

  .tag-link:hover .tag-arrow {
    opacity: 1;
    transform: translateX(0);
  }

  .tag-link:hover .tag-hash {
    opacity: 1;
  }

  /* ========================================================================
     CONTENT LAYOUT - Igual que Blog con TOC a la derecha
     ======================================================================== */

  .content-container {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
  }

  .content-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
  }

  .main-content {
    width: 100%;
    position: relative;
    z-index: 1;
  }

  .toc-wrapper {
    position: absolute;
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    overflow: visible;
    z-index: 10;
    pointer-events: none;
  }

  .toc-wrapper > :global(*) {
    pointer-events: auto;
  }

  .prose {
    width: 100%;
    position: relative;
    z-index: 1;
  }

  /* ========================================================================
     PROSE CONTENT STYLING (HackTheBox Theme)
     ======================================================================== */

  .prose :global(h2) {
    border-bottom: 2px solid rgba(159, 239, 0, 0.15);
    padding-bottom: 0.75rem;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    position: relative;
    color: var(--text-color);
  }

  .prose :global(h2::before) {
    content: '‚ñ∂';
    display: inline-block;
    margin-right: 0.75rem;
    color: #9fef00;
    font-size: 0.8em;
    opacity: 0.8;
  }

  .prose :global(h3) {
    color: var(--text-color);
    opacity: 0.95;
  }

  .prose :global(a) {
    color: #9fef00;
    text-decoration: none;
    border-bottom: 1px solid rgba(159, 239, 0, 0.25);
    transition: all 0.2s ease;
    position: relative;
  }

  .prose :global(a:hover) {
    color: #b4ff1a;
    border-bottom-color: #9fef00;
  }

  .prose :global(code) {
    background: color-mix(in srgb, var(--bg-color) 95%, #9fef00 5%);
    border: 1px solid color-mix(in srgb, var(--border-color) 80%, #9fef00 20%);
    color: #9fef00;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-weight: 600;
  }

  .prose :global(pre) {
    border: 1px solid color-mix(in srgb, var(--border-color) 70%, #9fef00 30%);
    border-radius: 8px;
    background: var(--card-bg);
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .prose :global(pre code) {
    background: transparent;
    border: none;
    padding: 0;
  }

  .prose :global(blockquote) {
    border-left: 4px solid #9fef00;
    background: color-mix(in srgb, var(--bg-color) 97%, #9fef00 3%);
    padding: 1.25rem 1.5rem;
    border-radius: 0 8px 8px 0;
    position: relative;
  }

  .prose :global(blockquote::before) {
    content: 'üí°';
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.5rem;
    opacity: 0.3;
  }

  /* ========================================================================
     RELATED WRITEUPS SECTION
     ======================================================================== */

  .related-section {
    max-width: 900px;
    margin: 4rem auto 0;
    padding-top: 3rem;
    border-top: 1px solid rgba(159, 239, 0, 0.1);
    position: relative;
    z-index: 5;
  }

  /* ========================================================================
     RESPONSIVE DESIGN
     ======================================================================== */

  @media (max-width: 768px) {
    .prose :global(h2::before) {
      display: none;
    }
    
    .htb-writeup {
      padding: 1rem;
    }
  }

  /* ========================================================================
     ACCESSIBILITY & PERFORMANCE
     ======================================================================== */

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .badge {
      border-width: 3px;
    }
    
    .breadcrumb,
    .technical-info,
    .tags-section {
      border-width: 3px;
    }
  }
</style>
