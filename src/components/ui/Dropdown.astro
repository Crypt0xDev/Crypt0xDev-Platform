---
export interface DropdownItem {
  label: string;
  href: string;
  icon?: string;
  description?: string;
}

export interface Props {
  label: string;
  items: DropdownItem[];
  icon?: string;
  currentPath?: string;
}

const { label, items, icon, currentPath = '' } = Astro.props;

const isActive = (href: string) => {
  return currentPath.startsWith(href);
};
---

<div class="relative group">
  <!-- Trigger Button -->
  <button
    class={`flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-lg transition-all duration-200 ${
      isActive(items[0]?.href.split('/').slice(0, 3).join('/'))
        ? 'bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300'
        : 'text-slate-600 dark:text-slate-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 hover:text-indigo-600 dark:hover:text-indigo-400'
    }`}
    aria-haspopup="true"
    aria-expanded="false"
  >
    {icon && <span class="text-lg opacity-80">{icon}</span>}
    <span>{label}</span>
    <svg 
      class="w-4 h-4 transition-transform duration-200 group-hover:rotate-180" 
      viewBox="0 0 24 24" 
      fill="none" 
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div
    class="absolute left-0 mt-2 w-64 bg-white dark:bg-slate-900 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-800 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform scale-95 group-hover:scale-100 z-50"
    role="menu"
  >
    <div class="py-2">
      {items.map((item, index) => (
        <a
          href={item.href}
          class={`flex items-start gap-3 px-4 py-3 transition-colors duration-150 ${
            index !== items.length - 1 ? 'border-b border-slate-100 dark:border-slate-800' : ''
          } ${
            currentPath.startsWith(item.href)
              ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300'
              : 'text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50'
          }`}
          role="menuitem"
        >
          {item.icon && (
            <span class="text-2xl flex-shrink-0 mt-0.5">{item.icon}</span>
          )}
          <div class="flex-1 min-w-0">
            <div class="font-medium">{item.label}</div>
            {item.description && (
              <div class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">
                {item.description}
              </div>
            )}
          </div>
        </a>
      ))}
    </div>
  </div>
</div>

<style>
  /* Ensure dropdown stays visible on hover */
  .group:hover > div[role="menu"] {
    pointer-events: auto;
  }
  
  /* Smooth animations */
  div[role="menu"] {
    pointer-events: none;
  }
  
  .group:hover div[role="menu"] {
    pointer-events: auto;
  }
</style>
